#!/bin/bash -x

#format wywolania pliku: skopiuj_poczte uzytkownik klient poczty. Przyklad: skopiuj_poczte admin WLM
#kopiuje poczte z zapisanych sciezek w katalogu poczty

KATALOG_GLOWNY=~/DW/badanie

function log()
{
	echo $1 >> ${KATALOG_GLOWNY}/log.txt 
}

UZYTKOWNIK=$1
KLIENT_POCZTY=$2

KATALOG_PRZEZNACZENIA=${KATALOG_GLOWNY}/Users/${UZYTKOWNIK}/Mail/${KLIENT_POCZTY} 

DATA=`date "+%y-%m-%d %H:%M:%S"`

log "$DATA - Preapering to copy ${KLIENT_POCZTY} files."

if [ ! -d $KATALOG_PRZEZNACZENIA ]; then 
	log "-  Error with copy. No ${KATALOG_PRZEZNACZENIA} folder."
	exit 1; #koniec skryptu
elif [ ! -e $KATALOG_PRZEZNACZENIA/path_${KLIENT_POCZTY}.txt ]; then
	log "-  Error with copy. No path_${KLIENT_POCZTY}.txt file."
	exit 1; #koniec skryptu
elif [ ! -s $KATALOG_PRZEZNACZENIA/path_${KLIENT_POCZTY}.txt ]; then
	log "-  Error with copy. File path_${KLIENT_POCZTY}.txt is empty."
	exit 1; #koniec skryptu
else
	#gdy aoutlook - brak parametru, kopiuje tylko pliki
	#gdy WLM lub Thunderbird nadaje parametr do kopiowania calych katalogow, podkatalogow i plikow
        [ "$KLIENT_POCZTY" == "Outlook" ] && PARAMETR="" || PARAMETR="-R" 
	#z racji iz potrzebujemy cala strukture kopiujemy wszystkie katalogi z podanej sciezki z pliku
	[ "$KLIENT_POCZTY" == "WLM" ] && PLIK="path_${KLIENT_POCZTY}.txt" || PLIK="mails_in_${KLIENT_POCZTY}.txt"
	
	for SCIEZKA_DO_ORYGINALU in `cat ${KATALOG_PRZEZNACZENIA}/${PLIK}`
	  do
		#gdy outlook kopiuje tylko wskazany plik gdy inne klienty kopije calle katalogi z plikami
		cp $PARAMETR "$SCIEZKA_DO_ORYGINALU"  "$KATALOG_PRZEZNACZENIA" &&
			#jesli sie uda skopiowac
			log "-  Coped ${KLIENT_POCZTY} files. OK." ||
				#jesli sie nie uda
				log "-  Error with copy ${KLIENT_POCZTY} files. Error." 
	done
fi


