#!/bin/bash -x

#format wywolania pliku: wyszukaj_PPZEGLADARKA uzytkownik PPZEGLADARKA. Przyklad: WYSZUKAJ_pRZEGLADARKI admin Ie
#kopiuje poczte z zapisanych sciezek w katalogu poczty

KATALOG_GLOWNY=~/DW/badanie

function log()
{
	echo $1 >> ${KATALOG_GLOWNY}/log.txt 
}

UZYTKOWNIK=$1
PPZEGLADARKA=$2

DATA=`date "+%y-%m-%d %H:%M:%S"`

log "$DATA - I look for ${PPZEGLADARKA} archives."

#tworzy katalogi jesli niema
mkdir -p "${KATALOG_GLOWNY}/Users/${UZYTKOWNIK}/Browsers/${PPZEGLADARKA}" &&
log "- ${PPZEGLADARKA} folders on destination drive correct. OK" || 
{ log " I coud NOT create ${PPZEGLADARKA} folders on destination drive. Error."; exit 1; }

if [ $PPZEGLADARKA == "IE" ]; 
then
	for PARTYCJA in `cat ${KATALOG_GLOWNY}/system_info/partycja_systemowa_windows.txt`
   	    do
		find /media/${PARTYCJA}/Users/${UZYTKOWNIK}/AppData/Local/Microsoft/Windows/Temporary\ Internet\ Files -name "index.dat" > ${KATALOG_GLOWNY}/Users/${UZYTKOWNIK}/Browsers/${PPZEGLADARKA}/path_${PPZEGLADARKA}_archives.txt && log  "- Link to ${PPZEGLADARKA} archive saved correct. OK." || log "- I could not find ${PPZEGLADARKA} archives on ${PARTYCJA}"		
	done
fi
